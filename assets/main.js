function onYouTubeIframeAPIReady(){ytbPlayer.player=new YT.Player(settings.ytPlayer,{height:"100%",width:"100%",playerVars:{autoplay:1,modestbranding:1,loop:1,iv_load_policy:3},events:{onReady:function(n){var r=n.target,i=utilities.getQueryParams("v"),t;i!=null?(r.loadVideoById(i),settings.urlInputCtrl.value="https://youtu.be/"+i,localStorage.removeItem("lastPlayList")):(t=utilities.getQueryParams("p"),!t&&settings.isAndroid&&(t=localStorage.lastPlayList),t||(t=settings.playLists[Math.floor(Math.random()*10*settings.playLists.length)%settings.playLists.length].id),localStorage.lastPlayList=t,r.loadPlaylist({list:t}),settings.playListPanel.value=t);window.onscroll=function(){settings.flowControlPanel.style.visibility=dhn_core_getScroll().y>0?"visible":"hidden"};utilities.toggleLoading(!1)},onStateChange:function(n){var t=n.target,f,r,u,i;switch(n.data){case YT.PlayerState.BUFFERING:f=utilities.getQueryParams("v",t.getVideoUrl());settings.urlInputCtrl.value="https://youtu.be/"+f;localStorage.currentVideoId=f;break;case YT.PlayerState.UNSTARTED:t.loaded?(i=t.getPlaylistIndex(),(i==0||i==-1)&&app.androidExit()):(r=t.getPlaylist(),r&&r.length>0&&(t.loaded=!0,t.setLoop(!0),u=0,app.firstLoading&&settings.isAndroid?localStorage.currentVideoId&&(r=t.getPlaylist(),u=r.indexOf(localStorage.currentVideoId),u<0&&(u=0),localStorage.removeItem("currentVideoId")):t.setShuffle(!0),t.playVideoAt(u)));app.firstLoading=!1;break;case YT.PlayerState.ENDED:i=t.getPlaylistIndex();(i==0||i==-1)&&app.androidExit()}if(settings.isAndroid&&android.onPlayerStateChanged)android.onPlayerStateChanged(n.data)},onError:function(n){var t=n.target,i=t.getPlaylist();i!=null&&t.getPlaylistIndex()==i.length-1&&app.androidExit();t.nextVideo()}},loaded_removed:!1})}var style,tag,firstScriptTag;HTMLButtonElement.prototype.listenForLongPress||(HTMLButtonElement.prototype.listenForLongPress=function(e){if((e==null&&(e=window.event),e==null||e.target==this)&&(this.isLongPressed=!1,this.pressTimer==null&&(this.pressTimer=setTimeout(function(n){n.isLongPressed=!0;n.pressTimer=null;n.className+=" hilight"},700,this)),!this.initialized)){if(this.initialized=!0,this.onlngclick==null){var onlngclick=this.getAttribute("onlngclick");onlngclick!=null&&(onlngclick.indexOf("(")>0?eval("this.onlngclick = function () { "+onlngclick+" }"):this.onlngclick=eval(onlngclick))}this.onlngclick!=null&&(this.org_onclick=this.onclick,this.onclick=function(n,t){clearTimeout(this.pressTimer);this.pressTimer=null;this.noClick||(this.isLongPressed=!1,this.org_onclick!=null&&this.org_onclick(n,t))},this.ontouchmove=function(){clearTimeout(this.pressTimer);this.pressTimer=null;this.isLongPressed=!1;this.className=this.className.replace(" hilight","")},this.ontouchcancel=this.ontouchend=this.onmouseup=function(){clearTimeout(this.pressTimer);this.pressTimer=null;this.isLongPressed?(this.isLongPressed=!1,this.noClick=!0,this.onlngclick&&this.onlngclick()):this.noClick=!1;this.className=this.className.replace(" hilight","")})}});String.prototype.format||(String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(t,i){return typeof n[i]!="undefined"?n[i]:t})});settings.isAndroid=!1;try{settings.isAndroid=typeof android!="undefined";settings.isAndroid&&(settings.androidPanel.style.display="",style=document.createElement("style"),style.type="text/css",style.innerHTML=".bottom > span { display: none }",document.getElementsByTagName("head")[0].appendChild(style))}catch(ex){alert(ex)}var utilities={debug:function(n){var t,i;this.debugDiv||(this.debugDiv=document.createElement("div"),this.debugDiv.className="debug-panel",this.debugDiv.style.position="fixed",this.debugDiv.style.right="0px",this.debugDiv.style.top="0px",this.debugDiv.style.zIndex=1e3,this.debugDiv.style.width="auto",this.debugDiv.style.maxWidth="50%",this.debugDiv.style.height="auto",this.debugDiv.style.maxHeight="100%",this.debugDiv.style.overflow="auto",this.debugDiv.style.backgroundColor="#cfbc51",this.debugDiv.style.padding="2px",this.mainContainer=document.body.firstElementChild,document.body.insertBefore(this.debugDiv,document.body.firstChild),t=document.createElement("div"),t.debugDiv=this.debugDiv,t.innerHTML="❦♡♥Hide Me♥♡❦",t.style.backgroundColor="#0094ff",t.style.textAlign="center",t.style.cursor="pointer",t.onclick=function(){this.debugDiv.style.display="none"},this.debugDiv.appendChild(t),this.debugDiv.msgContainer=document.createElement("div"),this.debugDiv.appendChild(this.debugDiv.msgContainer));i=document.createElement("div");i.innerHTML='<pre style="margin: 0px">• '+JSON.stringify(n)+"<\/pre>";this.debugDiv.msgContainer.appendChild(i);this.debugDiv.style.display="block"},getParams:function(n){return(n.match(new RegExp("([^?=&]+)(=([^&]*))?","g"))||[]).reduce(function(n,t){var i=t.split("=");return n[i[0]]=i[1]?unescape(i[1]):null,n},{})},getHashParams:function(n,t){return this._hashParams&&this._hashParams.v==t||(t||(t=window.location.hash),this._hashParams={},this._hashParams.v=t,t=t.replace("#",""),this._hashParams.p=this.getParams(t)),this._hashParams.p[n]},getQueryParams:function(n,t){return this._queryParams&&this._queryParams.v==t||(t||(t=window.location.href),this._queryParams={},this._queryParams.v=t,t=t.substr(t.indexOf("?")+1),this._queryParams.p=this.getParams(t)),this._queryParams.p[n]},toggleLoading:function(n){this.loadingDiv||(this.loadingDiv=document.createElement("div"),this.loadingDiv.className="loading-panel",this.loadingDiv.style.position="fixed",this.loadingDiv.style.left="0px",this.loadingDiv.style.top="0px",this.loadingDiv.style.zIndex=999,this.loadingDiv.style.width="100%",this.loadingDiv.style.height="100%",this.loadingDiv.style.opacity=.7,this.loadingDiv.style.backgroundColor="#CCC",this.loadingDiv.style.backgroundRepeat="no-repeat",this.loadingDiv.style.backgroundPosition="center center",this.loadingDiv.style.backgroundImage="loading.gif",this.mainContainer=document.body.firstElementChild,document.body.insertBefore(this.loadingDiv,document.body.firstChild));n?(this.mainContainer.orgOverflow=this.mainContainer.style.overflow,this.mainContainer.style.overflow="hidden"):this.mainContainer.orgOverflow!=null&&(this.mainContainer.style.overflow=this.mainContainer.orgOverflow);this.loadingDiv.style.display=n?"block":"none"},getCookie:function(n){var t=document.cookie.split(n+"=");return t.length==2?t.pop().split(";").shift():null},clearCookie:function(n){console.log("clear cookie "+n);document.cookie=encodeURIComponent(n)+"=deleted; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},postForm:function(n,t){return fetch(n,{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(function(n){if(console.log(n),n.ok)return n;throw new Error(n.status+"-"+n.statusText);})}},bannerTimer={startDate:Date.parse(settings.pasPanel.dataset.startDate),expectedDate:Date.parse(settings.expPanel.dataset.expDate),addZero:function(n){return n>9?n:"0"+n},displayTime:function(n){var t,i,r,u,f;return n=n/1e3,t=Math.floor(n/86400),i=0,t>365&&(i=Math.floor(t/365),t=t%365),n=n%86400,r=Math.floor(n/3600),n=n%3600,u=Math.floor(n/60),n=n%60,f=Math.floor(n),(i>0?i+" năm ":"")+t+" ngày "+this.addZero(r)+" giờ "+this.addZero(u)+" phút "+this.addZero(f)+" giây"},run:function(){var n=new Date;settings.pasPanel.innerHTML=this.displayTime(n-this.startDate);settings.expPanel.innerHTML=this.displayTime(this.expectedDate-n);setTimeout(function(n){n.run()},1e3,bannerTimer)}},ytbPlayer={player:null,play:function(n,t,i){var u,r,f;if(!n){this.player.playVideo();return}utilities.toggleLoading(!0);u=!1;r=null;n.indexOf("http")==0?n.indexOf("youtu.be")>0?(n.indexOf("?")>0&&(n=n.substr(0,n.indexOf("?"))),f=n.split("/"),r=f[f.length-1]):n.indexOf("youtube.com")>0&&(r=utilities.getQueryParams("v",n),r==null&&(r=utilities.getQueryParams("list",n),u=!0)):r=n;r!=null?t?(u?(localStorage.lastPlayList=r,this.player.stopVideo(),this.player.loadPlaylist({list:r}),settings.playListPanel.value=r,this.player.loaded=!1,settings.isAndroid||window.history.pushState(null,document.title,window.location.href.split(/[?#]/)[0]+"?p="+escape(r))):(localStorage.removeItem("lastPlayList"),i?this.addToPlayList(r):(this.player.loadVideoById(r),settings.urlInputCtrl.value="https://youtu.be/"+r,settings.playListPanel.value="",settings.isAndroid||window.history.pushState(null,document.title,window.location.href.split(/[?#]/)[0]+"?v="+escape(r)))),utilities.toggleLoading(!1)):location.href=window.location.href.split(/[?#]/)[0]+"?"+(u?"p":"v")+"="+r:utilities.toggleLoading(!1)},pause:function(){this.player.pauseVideo()},stop:function(){this.player.stopVideo()},isPlaying:function(){return this.player.getPlayerState()==1},seek:function(n){this.player.seekTo(this.player.getCurrentTime()+n)},addToPlayList:function(n){var i=0,t=this.player.getPlaylist(),r=this.player.getCurrentTime();t?(i=this.player.getPlaylistIndex(),this.player.stopVideo()):(t=[utilities.getParams(this.player.getVideoUrl()).v],this.isPlaying()&&this.player.stopVideo());this.player.loaded=!0;t.push(n);this.player.loadPlaylist(t,i,r)},getVideoOrientation:function(){var n=this.player.playerInfo.videoContentRect;return n.width>=n.height},isPause:function(){return this.player.getPlayerState()==2},togglePlaying:function(){return this.isPlaying()?(this.pause(),!1):(this.play(),!0)},getPlaylist:function(){return this.player.getPlaylist()}},app={initPlaylistSelector:function(){for(var i=settings.playListPanel,n,t=0;t<settings.playLists.length;t++)n=document.createElement("option"),n.text=settings.playLists[t].text,n.value=settings.playLists[t].id,i.add(n);i.onchange=function(){ytbPlayer.play("https://youtube.com/?list="+this.value,!0)}},doPlay:function(){ytbPlayer.play(settings.urlInputCtrl.value,!0);settings.playListPanel.value=""},doAdd:function(){ytbPlayer.play(settings.urlInputCtrl.value,!0,!0);settings.playListPanel.value=""},showMenu:function(n){clearTimeout(window.menuTimeout);var t=n.getBoundingClientRect();settings.menuPanel.style.left=t.left+"px";settings.menuPanel.style.top=t.top+t.height+2+"px";settings.menuPanel.style.display="block";n.onblur||(n.onblur=function(){window.menuTimeout=setTimeout(function(){app.hideMenu()},500)})},hideMenu:function(){settings.menuPanel.style.display="none"},onKeyUp:function(n,t){n.keyCode===13&&(n.preventDefault(),t.nextElementSibling.click())},onFocus:function(n){setTimeout(function(n){n.select()},100,n)},search:function(n){if(console.log("Video orientation:"+ytbPlayer.getVideoOrientation()),n!=""){utilities.toggleLoading(!0);var t=new XMLHttpRequest;t.onerror=function(){settings.searchResultPanel.innerHTML="System errors!!!";utilities.toggleLoading(!1)};t.onreadystatechange=function(){var i,f,n,r,u,e,t;if(this.readyState==4)if(this.status==200){for(i=JSON.parse(this.responseText),f="",t=0;t<i.length;t++)i[t].videoRenderer&&(detail=i[t].videoRenderer,n="LIVE",r="N/A",u="N/A",detail.lengthText&&(detail.lengthText&&(n=detail.lengthText.simpleText,n||(n=detail.lengthText.runs[0])),detail.shortViewCountText&&(r=detail.shortViewCountText.simpleText,n||(r=detail.shortViewCountText.runs[0])),detail.publishedTimeText&&(u=detail.publishedTimeText.simpleText,n||(u=detail.publishedTimeText.runs[0])),e=detail.ownerText.runs[0].text),f+='<div class="item"><a href="?v={2}" onclick="ytbPlayer.play(\'{2}\',true);return false;"><div><img src="{0}"/><span>{3}<\/span><\/div><\/a><div><h2><a href="?v={2}" onclick="ytbPlayer.play(\'{2}\',true);return false;">{1}<\/a><\/h2><h3>{6}<\/h3><span>{4} - {5}<\/span><br/><button onclick="ytbPlayer.play(\'{2}\',true);return false;">►<\/button>&nbsp;<button class="bt" onclick="ytbPlayer.addToPlayList(\'{2}\');return false;">➕<\/button><\/div><\/div>'.format(detail.thumbnail.thumbnails[0].url,detail.title.runs[0].text,detail.videoId,n,r,u,e));settings.searchResultPanel.innerHTML=f;utilities.toggleLoading(!1)}else this.onerror()};t.open("GET","http://dev-world.net/music/searchYoutube.ashx?s="+encodeURIComponent(n),!0);t.send()}},androidExit:function(){settings.isAndroid&&android.exitIfQualified()},firstLoading:!0};app.downloader={downloadAll:function(n){var t=ytbPlayer.getPlaylist(),i;t!=null&&this.startDownload(n,t.length)&&(i=i="http://dev-world.net/music/downloadYoutube.ashx",utilities.postForm(i,"p="+t.join(",")).then(function(n){return n.text()}).then(function(n){window.dlAllKey=n;setTimeout(app.downloader.checkDownloadAllStatus,5e3)}).catch(function(n){alert("Unable to download: "+n);app.downloader.resetDownload()}))},startDownload:function(n,t){if(window.dlBt)return!1;if(t){if(!confirm("Are you sure to download this video list ("+t+" items)?"))return!1}else if(!confirm("Are you sure to download this video?"))return!1;return n.innerHTML='<span class="rotate">'+n.getAttribute("data-loading")+"<\/span>",this.resetDownload(),window.dlBt=n,window.dlInterval=setInterval(function(){utilities.getCookie("Ytb_DownloadingFile")==="true"&&app.downloader.resetDownload()},500),!0},checkDownloadAllStatus:function(){var n="http://dev-world.net/music/downloadYoutube.ashx?c="+window.dlAllKey;fetch(n).then(function(n){return n.text()}).then(function(n){if(n=="done")app.downloader.resetDownload(),alert("Local download is done");else if(n=="ready"){var t=document.createElement("a");t.href="http://dev-world.net/music/downloadYoutube.ashx?k="+encodeURIComponent(window.dlAllKey);document.body.appendChild(t);t.click();t.remove()}else setTimeout(app.downloader.checkDownloadAllStatus,5e3)}).catch(function(n){alert("Unable to download:"+n);app.downloader.resetDownload()})},download:function(n){this.startDownload(n)&&utilities.postForm("http://dev-world.net/music/downloadYoutube.ashx","u="+encodeURIComponent(settings.urlInputCtrl.value)).then(function(n){return n.text()}).then(function(n){if(n[0]=="[")alert("Unable to download: "+n),app.downloader.resetDownload();else{var t=document.createElement("a");t.href="http://dev-world.net/music/downloadYoutube.ashx?k="+encodeURIComponent(n);document.body.appendChild(t);t.click();t.remove()}}).catch(function(n){alert("Unable to download: "+n);app.downloader.resetDownload()})},resetDownload:function(){clearInterval(window.dlInterval);utilities.clearCookie("Ytb_DownloadingFile");window.dlBt&&(window.dlBt.innerHTML=window.dlBt.getAttribute("data-text"),window.dlBt=null)}};window.onerror=function(n,t,i,r,u){return utilities.toggleLoading(!1),utilities.debug("Error message : "+n+"<br/>URL : "+t+"<br/>Line #: "+i+","+r),utilities.debug(u),!1};utilities.toggleLoading(!0);app.initPlaylistSelector();bannerTimer.run();tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)